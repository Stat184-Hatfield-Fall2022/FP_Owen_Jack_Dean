---
title: "Final Project"
author: "Owen Braglio, Dean Bae, Jack Billings"
date: "2022-12-02"
output:
  pdf_document: default
  html_document: default
---

# Report

### Research Question:

What is the relationship between a baseball team's runs scored, runs allowed, and their win rate for that season?

We wanted to find if there was a significant link between the runs scored by a team in a season, and their win rate. The initial hypothesis is yes of course, it should be a direct relationship, but factors like blowout games and close defeats may skew the numbers and make them less accurate than initially presumed.

### Data Source

We got both of our data sources from the MLB's website as they have collected all relevant data into a couple tables for each Baseball League. As all teams were gather from the same source it also ensured consistency between the numbers reported.

### Data Focus

We'll be focusing on Win Rate, Runs Scored and Runs Allowed to determine if there is a significant like between these factors and if a team made it to playoffs or not that season.

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
library(rvest)
library(dplyr)
library(readr)
library(ggplot2)
library()
library(tidyr)
library(knitr)
knitr::opts_chunk$set(echo = FALSE)
library(trackdown)
```

```{r}
#Read In Data
MLBStats <- read_html(
  x = "https://www.espn.com/mlb/standings"
) %>%
  html_elements(css = "table") %>%
  html_table()

View(MLBStats)
```

```{r}
#All American Playoff Teams
AmericanPlayoffTeams <- bind_cols(MLBStats[[1]], MLBStats[[2]])
AmericanPlayoffTeams <- AmericanPlayoffTeams[, -c(2:3)]
AmericanPlayoffTeams <- AmericanPlayoffTeams[, -c(3:5)]
AmericanPlayoffTeams <- AmericanPlayoffTeams[, -c(5:8)]
AmericanPlayoffTeams <- AmericanPlayoffTeams[-c(1,5:7,9:13,16:18),]
names(AmericanPlayoffTeams)[names(AmericanPlayoffTeams) == "X1...1"] <- "American League Playoff Teams"
names(AmericanPlayoffTeams)[names(AmericanPlayoffTeams) == "X3"] <- "PCT(Win Rate)"
names(AmericanPlayoffTeams)[names(AmericanPlayoffTeams) == "X7"] <- "RS(Runs Scored)"
names(AmericanPlayoffTeams)[names(AmericanPlayoffTeams) == "X8"] <- "RA(Runs Allowed)"
AmericanPlayoffTeams[1,1] = "New York Yankees"
AmericanPlayoffTeams[2,1] = "Toronto Blue Jays"
AmericanPlayoffTeams[3,1] = "Tampa Bay Rays"
AmericanPlayoffTeams[4,1] = "Cleveland Guardians"
AmericanPlayoffTeams[5,1] = "Houston Astros"
AmericanPlayoffTeams[6,1] = "Seattle Mariners"

```

```{r}
AmericanPlayoffTeamsModel <- lm(formula = as.numeric(AmericanPlayoffTeams[[2]])~as.numeric(AmericanPlayoffTeams[[4]], data= AmericanPlayoffTeams ))
```

```{r}
#All National Playoff Teams
NationalPlayoffTeams <-  bind_cols(MLBStats[[3]], MLBStats[[4]])
NationalPlayoffTeams <- NationalPlayoffTeams[, -c(2:3)]
NationalPlayoffTeams <- NationalPlayoffTeams[, -c(3:5)]
NationalPlayoffTeams <- NationalPlayoffTeams[, -c(5:8)]
NationalPlayoffTeams <- NationalPlayoffTeams[-c(1,5:7,9:13,16:18),]
names(NationalPlayoffTeams)[names(NationalPlayoffTeams) == "X1...1"] <- "National League Playoff Teams"
names(NationalPlayoffTeams)[names(NationalPlayoffTeams) == "X3"] <- "PCT(Win Rate)"
names(NationalPlayoffTeams)[names(NationalPlayoffTeams) == "X7"] <- "RS(Runs Scored)"
names(NationalPlayoffTeams)[names(NationalPlayoffTeams) == "X8"] <- "RA(Runs Allowed)"
NationalPlayoffTeams[1,1] = "Atlanta Braves"
NationalPlayoffTeams[2,1] = "New York Mets"
NationalPlayoffTeams[3,1] = "Philadelphia Phillies"
NationalPlayoffTeams[4,1] = "St. Louis Cardinals"
NationalPlayoffTeams[5,1] = "Los Angeles Dodgers"
NationalPlayoffTeams[6,1] = "San Diego Padres"
View(NationalPlayoffTeams)
```

```{r}
#All Playoff Teams
AmericanLeagueCombine <- AmericanPlayoffTeams
NationalLeagueCombine <- NationalPlayoffTeams

names(AmericanLeagueCombine)[names(AmericanLeagueCombine) == "American League Playoff Teams"] <- "Playoff Teams"
names(NationalLeagueCombine)[names(NationalLeagueCombine) == "National League Playoff Teams"] <- "Playoff Teams"

PlayoffLeagueStats <- rbind(AmericanLeagueCombine, NationalLeagueCombine)
View(PlayoffLeagueStats)
```

```{r}
#All American League Teams
AmericanLeagueTeams <- bind_cols(MLBStats[[1]], MLBStats[[2]])
AmericanLeagueTeams <- AmericanLeagueTeams[, -c(2:3)]
AmericanLeagueTeams <- AmericanLeagueTeams[, -c(3:5)]
AmericanLeagueTeams <- AmericanLeagueTeams[, -c(5:8)]
AmericanLeagueTeams <- AmericanLeagueTeams[-c(1,7,13),]
names(AmericanLeagueTeams)[names(AmericanLeagueTeams) == "X1...1"] <- "American League Teams"
names(AmericanLeagueTeams)[names(AmericanLeagueTeams) == "X3"] <- "PCT(Win Rate)"
names(AmericanLeagueTeams)[names(AmericanLeagueTeams) == "X7"] <- "RS(Runs Scored)"
names(AmericanLeagueTeams)[names(AmericanLeagueTeams) == "X8"] <- "RA(Runs Allowed)"
AmericanLeagueTeams[1,1] = "New York Yankees"
AmericanLeagueTeams[2,1] = "Toronto Blue Jays"
AmericanLeagueTeams[3,1] = "Tampa Bay Rays"
AmericanLeagueTeams[4,1] = "Baltimore Orioles"
AmericanLeagueTeams[5,1] = "Boston Red Sox"
AmericanLeagueTeams[6,1] = "Cleveland Guardians"
AmericanLeagueTeams[7,1] = "Chicago White Sox"
AmericanLeagueTeams[8,1] = "Minnesota Twins"
AmericanLeagueTeams[9,1] = "Detroit Tigers"
AmericanLeagueTeams[10,1] = "Kansas City Royals"
AmericanLeagueTeams[11,1] = "Houston Astros"
AmericanLeagueTeams[12,1] = "Seattle Mariners"
AmericanLeagueTeams[13,1] = "Los Angeles Angels"
AmericanLeagueTeams[14,1] = "Texas Rangers"
AmericanLeagueTeams[15,1] = "Oakland Athletics"
```

```{r}
#All National League Teams
NationalLeagueTeams <- bind_cols(MLBStats[[3]], MLBStats[[4]])
NationalLeagueTeams <- NationalLeagueTeams[, -c(2:3)]
NationalLeagueTeams <- NationalLeagueTeams[, -c(3:5)]
NationalLeagueTeams <- NationalLeagueTeams[, -c(5:8)]
NationalLeagueTeams <- NationalLeagueTeams[-c(1,7,13),]
names(NationalLeagueTeams)[names(NationalLeagueTeams) == "X1...1"] <- "National League Teams"
names(NationalLeagueTeams)[names(NationalLeagueTeams) == "X3"] <- "PCT(Win Rate)"
names(NationalLeagueTeams)[names(NationalLeagueTeams) == "X7"] <- "RS(Runs Scored)"
names(NationalLeagueTeams)[names(NationalLeagueTeams) == "X8"] <- "RA(Runs Allowed)"
NationalLeagueTeams[1,1] = "Atlanta Braves"
NationalLeagueTeams[2,1] = "New York Mets"
NationalLeagueTeams[3,1] = "Philadelphia Phillies"
NationalLeagueTeams[4,1] = "Miami Marlins"
NationalLeagueTeams[5,1] = "Washington Nationals"
NationalLeagueTeams[6,1] = "St. Louis Cardinals"
NationalLeagueTeams[7,1] = "Milwaukee Brewers"
NationalLeagueTeams[8,1] = "Chicago Cubs"
NationalLeagueTeams[9,1] = "Pittsburgh Pirates"
NationalLeagueTeams[10,1] = "Cincinnati Reds"
NationalLeagueTeams[11,1] = "Los Angeles Dodgers"
NationalLeagueTeams[12,1] = "San Diego Padres"
NationalLeagueTeams[13,1] = "San Francisco Giants"
NationalLeagueTeams[14,1] = "Arizona Diamondbacks"
NationalLeagueTeams[15,1] = "Colarado Rockies"
```

```{r}
#All Teams Combined
AmericanTeamsCombine <- AmericanLeagueTeams
NationalTeamsCombine <- NationalLeagueTeams

names(AmericanTeamsCombine)[names(AmericanTeamsCombine) == "American League Teams"] <- "All Teams"
names(NationalTeamsCombine)[names(NationalTeamsCombine) == "National League Teams"] <- "All Teams"

AllTeamsStats <- rbind(AmericanTeamsCombine, NationalTeamsCombine)
```

```{r, echo= FALSE}
#Change table character to numeric
PlayoffLeagueStats$`PCT(Win Rate)` <- as.numeric(PlayoffLeagueStats$`PCT(Win Rate)`)
PlayoffLeagueStats$`RS(Runs Scored)` <- as.numeric(PlayoffLeagueStats$`RS(Runs Scored)`)
PlayoffLeagueStats$`RA(Runs Allowed)` <- as.numeric(PlayoffLeagueStats$`RA(Runs Allowed)`)
sapply(PlayoffLeagueStats, class)
```

```{r echo = FALSE}
notPlayoffTeams <- AllTeamsStats[-c(1,2,3,6,11,12,16,17,18,21,26,27),]
notPlayoffTeams$`PCT(Win Rate)` <- as.numeric(notPlayoffTeams$`PCT(Win Rate)`)
notPlayoffTeams$`RS(Runs Scored)` <- as.numeric(notPlayoffTeams$`RS(Runs Scored)`)
notPlayoffTeams$`RA(Runs Allowed)` <- as.numeric(notPlayoffTeams$`RA(Runs Allowed)`)
```

# Not Playoff Teams Summary table

```{r}


notplayoffTeamsSummaryPCT <- notPlayoffTeams  %>%
  summarize(count = n(), 
            "mean" = round(mean(notPlayoffTeams$`PCT(Win Rate)`), digits = 3),
            "min" = round(min(notPlayoffTeams$`PCT(Win Rate)`, digits = 3)),
            "firstQuintile" = round(quantile(notPlayoffTeams$`PCT(Win Rate)`, .2), digits = 3),
            "secondQuintile" = round(quantile(notPlayoffTeams$`PCT(Win Rate)`, .4), digits = 3),
            "median" = round(median(notPlayoffTeams$`PCT(Win Rate)`), digits = 3),
            "thirdQuintile" = round(quantile(notPlayoffTeams$`PCT(Win Rate)`, .6), digits = 3),
            "fourthQuintile" = round(quantile(notPlayoffTeams$`PCT(Win Rate)`, .8), digits = 3),
            "max" = round(max(notPlayoffTeams$`PCT(Win Rate)`), digits = 3),
            "standdev" = round(sd(notPlayoffTeams$`PCT(Win Rate)`), digits = 3))

notplayoffTeamsSummaryRS <- notPlayoffTeams  %>%
  summarize(count = n(),
            "mean" = round(mean(notPlayoffTeams$`RS(Runs Scored)`), digits = 3),
            "min" = round(min(notPlayoffTeams$`RS(Runs Scored)`), digits = 3),
            "firstQuintile" = round(quantile(notPlayoffTeams$`RS(Runs Scored)`, .2), digits = 3),
            "secondQuintile" = round(quantile(notPlayoffTeams$`RS(Runs Scored)`, .4), digits = 3),
            "median" = round(median(notPlayoffTeams$`RS(Runs Scored)`), digits = 3),
            "thirdQuintile" = round(quantile(notPlayoffTeams$`RS(Runs Scored)`, .6), digits = 3),
            "fourthQuintile" = round(quantile(notPlayoffTeams$`RS(Runs Scored)`, .8), digits = 3),
            "max" = round(max(notPlayoffTeams$`RS(Runs Scored)`), digits = 3),
            "standdev" = round(sd(notPlayoffTeams$`RS(Runs Scored)`), digits = 3))

notplayoffTeamsSummaryRA <- notPlayoffTeams  %>%
  summarize(count = n(),
            "mean" = mean(notPlayoffTeams$`RA(Runs Allowed)`),
            "min" = min(notPlayoffTeams$`RA(Runs Allowed)`),
            "firstQuintile" = quantile(notPlayoffTeams$`RA(Runs Allowed)`, .2),
            "secondQuintile" = quantile(notPlayoffTeams$`RA(Runs Allowed)`, .4), 
            "median" = median(notPlayoffTeams$`RA(Runs Allowed)`),
            "thirdQuintile" = quantile(notPlayoffTeams$`RA(Runs Allowed)`, .6),
            "fourthQuintile" = quantile(notPlayoffTeams$`RA(Runs Allowed)`, .8),
            "max" = max(notPlayoffTeams$`RA(Runs Allowed)`),
            "standdev" = sd(notPlayoffTeams$`RA(Runs Allowed)`))

Merged <- rbind(notplayoffTeamsSummaryPCT, notplayoffTeamsSummaryRS)
Merged <- rbind(Merged, notplayoffTeamsSummaryRA)
kable(Merged)



```

## Playoff Teams summary table

```{r}
PlayoffLeagueStatsSummaryPCT <- PlayoffLeagueStats %>%
  summarize(count = n(), 
            "mean" = mean(PlayoffLeagueStats$`PCT(Win Rate)`),
            "min" = min(PlayoffLeagueStats$`PCT(Win Rate)`),
            "firstQuintile" = quantile(PlayoffLeagueStats$`PCT(Win Rate)`, .2),
            "secondQuintile" = quantile(PlayoffLeagueStats$`PCT(Win Rate)`, .4),
            "median" = median(PlayoffLeagueStats$`PCT(Win Rate)`),
            "thirdQuintile" = quantile(PlayoffLeagueStats$`PCT(Win Rate)`, .6),
            "fourthQuintile" = quantile(PlayoffLeagueStats$`PCT(Win Rate)`, .8),
            "max" = max(PlayoffLeagueStats$`PCT(Win Rate)`),
            "standdev" = sd(PlayoffLeagueStats$`PCT(Win Rate)`))

PlayoffLeagueStatsSummaryRS <- PlayoffLeagueStats  %>%
  summarize(count = n(),
            "mean" = mean(PlayoffLeagueStats$`RS(Runs Scored)`),
            "min" = min(PlayoffLeagueStats$`RS(Runs Scored)`),
            "firstQuintile" = quantile(PlayoffLeagueStats$`RS(Runs Scored)`, .2),
            "secondQuintile" = quantile(PlayoffLeagueStats$`RS(Runs Scored)`, .4),
            "median" = median(PlayoffLeagueStats$`RS(Runs Scored)`),
            "thirdQuintile" = quantile(PlayoffLeagueStats$`RS(Runs Scored)`, .6),
            "fourthQuintile" = quantile(PlayoffLeagueStats$`RS(Runs Scored)`, .8),
            "max" = max(PlayoffLeagueStats$`RS(Runs Scored)`),
            "standdev" = sd(PlayoffLeagueStats$`RS(Runs Scored)`))

PlayoffLeagueStatsSummaryRA <- PlayoffLeagueStats  %>%
  summarize(count = n(),
            "mean" = mean(PlayoffLeagueStats$`RA(Runs Allowed)`),
            "min" = min(PlayoffLeagueStats$`RA(Runs Allowed)`),
            "firstQuintile" = quantile(PlayoffLeagueStats$`RA(Runs Allowed)`, .2),
            "secondQuintile" = quantile(PlayoffLeagueStats$`RA(Runs Allowed)`, .4), 
            "median" = median(PlayoffLeagueStats$`RA(Runs Allowed)`),
            "thirdQuintile" = quantile(PlayoffLeagueStats$`RA(Runs Allowed)`, .6),
            "fourthQuintile" = quantile(PlayoffLeagueStats$`RA(Runs Allowed)`, .8),
            "max" = max(PlayoffLeagueStats$`RA(Runs Allowed)`),
            "standdev" = sd(PlayoffLeagueStats$`RA(Runs Allowed)`))

MergedPlayoff <- rbind(PlayoffLeagueStatsSummaryPCT, PlayoffLeagueStatsSummaryRS)
MergedPlayoff <- rbind(MergedPlayoff, PlayoffLeagueStatsSummaryRA)
kable(MergedPlayoff)
```

```{r, echo = FALSE}
#merge_table <- rbind(notplayoffTeamsSummary, PlayoffLeagueStatsSummary)
#merge_table
```

## All League Teams chart

```{r}
ggplot(data = AllTeamsStats, aes(x= as.numeric(AllTeamsStats[[2]]), y =as.numeric(AllTeamsStats[[3]]), color =AllTeamsStats[[1]], size =AllTeamsStats[[4]])) + geom_point()  + xlab("PCT(Win Rate)")+ ylab("RS(Runs Scored")+ ggtitle("AllTeams Win Rate per Runs scored)") +labs(color = "Teams") + labs(size = "RA(Runs Allows)")
```

## National League Teams chart

```{r}
ggplot(data = NationalLeagueTeams, aes(x= as.numeric(NationalLeagueTeams[[2]]), y =as.numeric(NationalLeagueTeams[[3]]), color =NationalLeagueTeams[[1]], size =NationalLeagueTeams[[4]])) + geom_point()  + xlab("PCT(Win Rate)")+ ylab("RS(Runs Scored)")+ ggtitle("National League Teams Win Rate per Runs scored") +labs(color = "Teams") + labs(size = "RA(Runs Allows)")
```

## American League Teams chart

```{r}
ggplot(data = AmericanLeagueTeams, aes(x= as.numeric(AmericanLeagueTeams[[2]]), y =as.numeric(AmericanLeagueTeams[[3]]), color =AmericanLeagueTeams[[1]], size =AmericanLeagueTeams[[4]])) + geom_point()  + xlab("PCT(Win Rate)")+ ylab("RS(Runs Scored)")+ ggtitle("American League Teams Win Rate per Runs scored") +labs(color = "Teams") + labs(size = "RA(Runs Allows)")
```

## Play off League Teams chart

```{r}
ggplot(data = PlayoffLeagueStats, aes(x= as.numeric(PlayoffLeagueStats[[2]]), y =as.numeric(PlayoffLeagueStats[[3]]), color =PlayoffLeagueStats[[1]], size =PlayoffLeagueStats[[4]])) + geom_point()  + xlab("PCT(Win Rate)")+ ylab("RS(Runs Scored)")+ ggtitle("American League Teams Win Rate per Runs scored") +labs(color = "Teams") + labs(size = "RA(Runs Allows)")
```

## National Play off Teams chart

```{r}
ggplot(data = NationalPlayoffTeams, aes(x= as.numeric(NationalPlayoffTeams[[2]]), y =as.numeric(NationalPlayoffTeams[[3]]), color =NationalPlayoffTeams[[1]], size =NationalPlayoffTeams[[4]])) + geom_point()  + xlab("PCT(Win Rate)")+ ylab("RS(Runs Scored)")+ ggtitle("American League Teams Win Rate per Runs scored") +labs(color = "Teams") + labs(size = "RA(Runs Allows)")
```

## American Play off Teams chart

```{r}
ggplot(data = AmericanPlayoffTeams, aes(x= as.numeric(AmericanPlayoffTeams[[2]]), y =as.numeric(AmericanPlayoffTeams[[3]]), color =AmericanPlayoffTeams[[1]], size =AmericanPlayoffTeams[[4]])) + geom_point()  + xlab("PCT(Win Rate)")+ ylab("RS(Runs Scored)")+ ggtitle("American League Teams Win Rate per Runs scored") +labs(color = "Teams") + labs(size = "RA(Runs Allows)")
```
